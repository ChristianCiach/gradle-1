%!TEX root = userguide.tex
\chapter{OSGi Plugin} % (fold)
\label{cha:osgi_plugin}
The Gradle OSGi plugin enables the generation of an OSGi manifest. This OSGi manifest is automatically added to the jars produces by the Java plugin \texttt{libs} bundle. This plugin makes heavy use of Peter Kriens \href{http://www.aqute.biz/Code/Bnd}{BND tool}. 

The OSGi plugin adds an \texttt{osgi} property to every \emph{jar} generated by the \texttt{libs} bundle. This \texttt{osgi} property points to an instance of \href{\API plugins.osgi/OsgiManifest.html}{org.gradle.api.plugins.osgi.OsgiManifest}. Via the OsgiManifest object you can control the generation of the OSGi Manifest of the respective jar. The OSGi plugin assign default values to the OsgiManifest object. 
\begin{table}
\begin{center}
	\begin{tabular}{|l|l|l|} \hline
		Task Property & Convention Property \\ \hline
		classesDir & project.classesDir \\ \hline
		version & project.version \\ \hline
		name & project.archivesBaseName \\ \hline
		symbolicName & transformation of the name and the group to produce a valid OSGi symbolic name \\ \hline		
		classpath & project.dependencies.resolve('runtime') \\ \hline		
	\end{tabular}
\end{center}
\caption{OSGi Properties}
\end{table}
A classes in the classes dir are analyzed regarding there package dependencies and the packages they expose. Based on this the \emph{Import-Package} and the \emph{Export-Package} values of the OSGi Manifest are calculated. If the classpath contains jars with an OSGi bundle, the bundle information is used to specify version information for the \emph{Import-Package} value. Beside the explicit properties of the \texttt{OsgiManifest} object you can add instructions.
\begin{Verbatim}
configure(project.archive_jar.osgi) {
    name = 'overwrittenSpecialOsgiName
    instruction 'Private-Package',
            'org.mycomp.package1',
            'org.mycomp.package2'
    instruction 'Bundle-Vendor', 'MyCompany'
    instruction 'Bundle-Description', 'Platform2: Metrics 2 Measures Framework'
    instruction 'Bundle-DocURL', 'http://www.mycompany.com'
}
\end{Verbatim}
The first argument of the instruction call is the key of the property. The other arguments form the value. They are joined by Gradle with the \texttt{,} separator. To learn more about the available instructions have a look at the \href{http://www.aqute.biz/Code/Bnd}{BND tool}.
% chapter osgi_plugin (end)